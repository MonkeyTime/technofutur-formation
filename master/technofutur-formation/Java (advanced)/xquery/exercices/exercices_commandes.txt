Obtenir la liste des clients (attention à l'espace de noms):

<clients>
    <client>Clinique Saint-Paul</client>
    <client>Marc Albert</client>
    <client>Libert Luc</client>
    <client>Declerck Serge</client>
    <client>Clip-Art sa</client>
    <client>Lavigne Gilbert</client>
    <client>Tassin René</client>
</clients>

declare namespace cli = "http://www.samples.com/clients";
<clients>
{
  for $client in doc("C:\xquery\commandes\clients.xml")/cli:clients/cli:client
  return 
  <client>{$client/cli:nom/text()}</client>
}
</clients>



Idem, mais triée par ordre alphabétique:

<clients>
    <client>Clinique Saint-Paul</client>
    <client>Clip-Art sa</client>
    <client>Declerck Serge</client>
    <client>Lavigne Gilbert</client>
    <client>Libert Luc</client>
    <client>Marc Albert</client>
    <client>Tassin René</client>
</clients>

declare namespace cli = "http://www.samples.com/clients";
<clients>
{
  for $client in doc("C:\xquery\commandes\clients.xml")/cli:clients/cli:client
  order by $client
  return 
  <client>{$client/cli:nom/text()}</client>
}
</clients>



Idem, mais en placant les clients dans des catégories différentes (attribut type):

<clients>
    <sociétés>
        <client>Clinique Saint-Paul</client>
        <client>Clip-Art sa</client>
    </sociétés>
    <indépendants>
        <client>Declerck Serge</client>
        <client>Marc Albert</client>
    </indépendants>
    <privés>
        <client>Lavigne Gilbert</client>
        <client>Libert Luc</client>
        <client>Tassin René</client>
    </privés>
</clients>

declare namespace cli = "http://www.samples.com/clients";
<clients>
{
  <sociétés>
  {
    for $c in doc("C:\xquery\commandes\clients.xml")/cli:clients/cli:client
    where $c/@type = "société"
    return 
    <client>{$c/cli:nom/text()}</client>
  }
  </sociétés>
  ,
  <indépendants>
  {
    for $c in doc("C:\xquery\commandes\clients.xml")/cli:clients/cli:client
    where $c/@type = "indépendant"
    return 
    <client>{$c/cli:nom/text()}</client>
  }
  </indépendants>
  ,
  <privés>
  {
    for $c in doc("C:\xquery\commandes\clients.xml")/cli:clients/cli:client
    where $c/@type = "privé"
    return 
    <client>{$c/cli:nom/text()}</client>
  }
  </privés>
}
</clients>



Obtenir la liste des clients en les classant par pays (il faut ici utiliser un constructeur 
d'élément "calculé" qui calcule le nom d'une balise à l'aide d'accolades):

<clients>
    <Belgique>
        <client>Marc Albert</client>
        <client>Libert Luc</client>
        <client>Lavigne Gilbert</client>
    </Belgique>
    <France>
        <client>Clinique Saint-Paul</client>
        <client>Declerck Serge</client>
        <client>Clip-Art sa</client>
        <client>Tassin René</client>
    </France>
</clients>

declare namespace cli = "http://www.samples.com/clients";
<clients>
{
  <Belgique>
  {
    for $c in doc("C:\xquery\commandes\clients.xml")/cli:clients/cli:client
    where $c/cli:adresse-livraison/cli:pays = "Belgique"
    return 
    <client>{$c/cli:nom/text()}</client>
  }
  </Belgique>
  ,
  <France>
  {
    for $c in doc("C:\xquery\commandes\clients.xml")/cli:clients/cli:client
    where $c/cli:adresse-livraison/cli:pays = "France"
    return 
    <client>{$c/cli:nom/text()}</client>
  }
  </France>
}
</clients>


Idem, mais ajouter la tva si elle existe:

<clients>
    <Belgique>
        <client tva="BE 32-424-745-201-45454">Marc Albert</client>
        <client>Libert Luc</client>
        <client>Lavigne Gilbert</client>
    </Belgique>
    <France>
        <client tva="FR 22-424-761-419-00000">Clinique Saint-Paul</client>
        <client tva="FR 18-123-756-999-34432">Declerck Serge</client>
        <client tva="FR 18-678-761-987-00223">Clip-Art sa</client>
        <client>Tassin René</client>
    </France>
</clients>

declare namespace cli = "http://www.samples.com/clients";
<clients>
{
  <Belgique>
  {
    for $c in doc("C:\xquery\commandes\clients.xml")/cli:clients/cli:client
    where $c/cli:adresse-livraison/cli:pays = "Belgique"
    return
    if($c/cli:tva != "")
    then
    <client tva="{$c/cli:tva/text()}">{$c/cli:nom/text()}</client>
    else
    <client>{$c/cli:nom/text()}</client>
  }
  </Belgique>
  ,
  <France>
  {
    for $c in doc("C:\xquery\commandes\clients.xml")/cli:clients/cli:client
    where $c/cli:adresse-livraison/cli:pays = "France"
    return
    if($c/cli:tva != "")
    then
    <client tva="{$c/cli:tva/text()}">{$c/cli:nom/text()}</client>
    else
    <client>{$c/cli:nom/text()}</client>
  }
  </France>
}
</clients>



Obtenir la liste des produits:

<produits>
    <produit>Agrafes pour agrafeuses 24/6mm</produit>
    <produit>Agrafes pour agrafeuses 24/8mm</produit>
    <produit>Agrafeuse manuelle - modèle Rapid Z1</produit>
    <produit>Agrafeuse électrique - modèle Rapid Z20</produit>
    <produit>Baguette pour reliure perforée 21 anneaux - 11mm</produit>
    <produit>Baguette pour reliure perforée 21 anneaux - 9mm</produit>
    <produit>Perforatrice de bureau - Buromat 6544</produit>
    <produit>Perforatrice de bureau - Buromat 6545</produit>
    <produit>Relieuse spirale (21 anneaux) - Rapid 200</produit>
</produits>

declare namespace prod = "http://www.samples.com/produits";
<produits>
{
  for $p in doc("C:\xquery\commandes\produits.xml")/prod:catalogue/prod:produit
  order by $p
  return 
  <produit>
    {$p/prod:nom/text()}
  </produit>
}
</produits>




Idem en ajoutant le code:

<produits>
    <produit code="P5">Agrafes pour agrafeuses 24/6mm</produit>
    <produit code="P6">Agrafes pour agrafeuses 24/8mm</produit>
    <produit code="P3">Agrafeuse manuelle - modèle Rapid Z1</produit>
    <produit code="P4">Agrafeuse électrique - modèle Rapid Z20</produit>
    <produit code="P9">Baguette pour reliure perforée 21 anneaux - 11mm</produit>
    <produit code="P8">Baguette pour reliure perforée 21 anneaux - 9mm</produit>
    <produit code="P1">Perforatrice de bureau - Buromat 6544</produit>
    <produit code="P2">Perforatrice de bureau - Buromat 6545</produit>
    <produit code="P7">Relieuse spirale (21 anneaux) - Rapid 200</produit>
</produits>

declare namespace prod = "http://www.samples.com/produits";
<produits>
{
  for $p in doc("C:\xquery\commandes\produits.xml")/prod:catalogue/prod:produit
  order by $p
  return 
  <produit code="{$p/@id}">
    {$p/prod:nom/text()}
  </produit>
}
</produits>



Idem en classant les produits par catégorie (utilisez les deux documents XML):

<produits>
    <catégorie nom="Fournitures de bureau">
        <produit code="P5">Agrafes pour agrafeuses 24/6mm</produit>
        <produit code="P6">Agrafes pour agrafeuses 24/8mm</produit>
        <produit code="P9">Baguette pour reliure perforée 21 anneaux - 11mm</produit>
        <produit code="P8">Baguette pour reliure perforée 21 anneaux - 9mm</produit>
    </catégorie>
    <catégorie nom="Matériels de bureau">
        <produit code="P3">Agrafeuse manuelle - modèle Rapid Z1</produit>
        <produit code="P4">Agrafeuse électrique - modèle Rapid Z20</produit>
        <produit code="P1">Perforatrice de bureau - Buromat 6544</produit>
        <produit code="P2">Perforatrice de bureau - Buromat 6545</produit>
        <produit code="P7">Relieuse spirale (21 anneaux) - Rapid 200</produit>
    </catégorie>
</produits>

declare namespace prod = "http://www.samples.com/produits";
<produits>
{
  <catégories nom="Fournitures de bureau">
  {
    for $p in doc("C:\xquery\commandes\produits.xml")/prod:catalogue/prod:produit
    where $p/@catégorie = "fourniture"
    order by $p
    return 
    <produit code="{$p/@id}">
      {$p/prod:nom/text()}
    </produit>
  }
  </catégories>
  ,
  <catégories nom="Matériels de bureau">
  {
    for $p in doc("C:\xquery\commandes\produits.xml")/prod:catalogue/prod:produit
    where $p/@catégorie = "matériel"
    order by $p
    return 
    <produit code="{$p/@id}">
      {$p/prod:nom/text()}
    </produit>
  }
  </catégories>
}
</produits>



La liste des produits avec le nom suivi entre parenthèses de la catégorie:

<produits>
    <produit code="P5">Agrafes pour agrafeuses 24/6mm (Fournitures de bureau)</produit>
    <produit code="P6">Agrafes pour agrafeuses 24/8mm (Fournitures de bureau)</produit>
    <produit code="P8">Baguette pour reliure perforée 21 anneaux - 9mm (Fournitures de bureau)</produit>
    <produit code="P9">Baguette pour reliure perforée 21 anneaux - 11mm (Fournitures de bureau)</produit>
    <produit code="P1">Perforatrice de bureau - Buromat 6544 (Matériels de bureau)</produit>
    <produit code="P2">Perforatrice de bureau - Buromat 6545 (Matériels de bureau)</produit>
    <produit code="P3">Agrafeuse manuelle - modèle Rapid Z1 (Matériels de bureau)</produit>
    <produit code="P4">Agrafeuse électrique - modèle Rapid Z20 (Matériels de bureau)</produit>
    <produit code="P7">Relieuse spirale (21 anneaux) - Rapid 200 (Matériels de bureau)</produit>
</produits>

declare namespace prod = "http://www.samples.com/produits";
<produits>
{
  for $p in doc("C:\xquery\commandes\produits.xml")/prod:catalogue/prod:produit
  order by $p
  return
  if($p/@catégorie = "matériel")
  then 
  <produit code="{$p/@id}">
    {concat($p/prod:nom/text(), " ", "(Matériels de bureau)")}
  </produit>
  else
  <produit code="{$p/@id}">
    {concat($p/prod:nom/text(), " ", "(Fournitures de bureau)")}
  </produit>
}
</produits>



Mettre la liste des produits précédente dans une variable et l'utiliser pour dresser la
liste des commandes de la manière suivante:

<commandes>
    <commande id="CMD0001">
        <produit quantité="1">Perforatrice de bureau - Buromat 6544 (Matériels de bureau)</produit>
        <produit quantité="1">Agrafeuse manuelle - modèle Rapid Z1 (Matériels de bureau)</produit>
    </commande>
    <commande id="CMD0002">
        <produit quantité="1">Agrafeuse électrique - modèle Rapid Z20 (Matériels de bureau)</produit>
        <produit quantité="10">Agrafes pour agrafeuses 24/8mm (Fournitures de bureau)</produit>
    </commande>
    <commande id="CMD0003">
        <produit quantité="1">Relieuse spirale (21 anneaux) - Rapid 200 (Matériels de bureau)</produit>
        <produit quantité="10">Baguette pour reliure perforée 21 anneaux - 9mm (Fournitures de bureau)</produit>
        <produit quantité="10">Baguette pour reliure perforée 21 anneaux - 11mm (Fournitures de bureau)</produit>
    </commande>
    <commande id="CMD0004">
        <produit quantité="1">Agrafeuse manuelle - modèle Rapid Z1 (Matériels de bureau)</produit>
        <produit quantité="1">Agrafes pour agrafeuses 24/8mm (Fournitures de bureau)</produit>
    </commande>
    <commande id="CMD0005">
        <produit quantité="2">Agrafeuse électrique - modèle Rapid Z20 (Matériels de bureau)</produit>
        <produit quantité="20">Agrafes pour agrafeuses 24/8mm (Fournitures de bureau)</produit>
    </commande>
    <commande id="CMD0006">
        <produit quantité="2">Agrafes pour agrafeuses 24/6mm (Fournitures de bureau)</produit>
    </commande>
    <commande id="CMD0007">
        <produit quantité="2">Agrafes pour agrafeuses 24/6mm (Fournitures de bureau)</produit>
    </commande>
    <commande id="CMD0008">
        <produit quantité="10">Agrafes pour agrafeuses 24/6mm (Fournitures de bureau)</produit>
    </commande>
</commandes>

declare namespace prod = "http://www.samples.com/produits";
declare namespace cmd = "http://www.samples.com/commandes";
declare variable $produits := for $p in doc("C:\xquery\commandes\produits.xml")/prod:catalogue/prod:produit
    order by $p
    return 
    if($p/@catégorie = "matériel")
    then 
    <produit code="{$p/@id}">
      {concat($p/prod:nom/text(), " ", "(Matériels de bureau)")}
    </produit>
    else
    <produit code="{$p/@id}">
      {concat($p/prod:nom/text(), " ", "(Fournitures de bureau)")}
    </produit>;

<commandes>
{
  
}
</commandes>



Pour les fortiches, ajouter à la liste des commandes le prix des produits (en tenant
compte du tarif qui diminue en fonction de la quantité):


<commandes>
    <commande id="CMD0001">
        <produit quantité="1" prix-unitaire="5.50">Perforatrice de bureau - Buromat 6544</produit>
        <produit quantité="1" prix-unitaire="5.85">Agrafeuse manuelle - modèle Rapid Z1</produit>
    </commande>
    <commande id="CMD0002">
        <produit quantité="1" prix-unitaire="196.95">Agrafeuse électrique - modèle Rapid Z20</produit>
        <produit quantité="10" prix-unitaire="5.00">Agrafes pour agrafeuses 24/8mm</produit>
    </commande>
    <commande id="CMD0003">
        <produit quantité="1" prix-unitaire="163.00">Relieuse spirale (21 anneaux) - Rapid 200</produit>
        <produit quantité="10" prix-unitaire="6.20">Baguette pour reliure perforée 21 anneaux - 9mm</produit>
        <produit quantité="10" prix-unitaire="7.40">Baguette pour reliure perforée 21 anneaux - 11mm</produit>
    </commande>
    <commande id="CMD0004">
        <produit quantité="1" prix-unitaire="5.85">Agrafeuse manuelle - modèle Rapid Z1</produit>
        <produit quantité="1" prix-unitaire="5.50">Agrafes pour agrafeuses 24/8mm</produit>
    </commande>
    <commande id="CMD0005">
        <produit quantité="2" prix-unitaire="">Agrafeuse électrique - modèle Rapid Z20</produit>
        <produit quantité="20" prix-unitaire="">Agrafes pour agrafeuses 24/8mm</produit>
    </commande>
    <commande id="CMD0006">
        <produit quantité="2" prix-unitaire="7.20">Agrafes pour agrafeuses 24/6mm</produit>
    </commande>
    <commande id="CMD0007">
        <produit quantité="2" prix-unitaire="7.20">Agrafes pour agrafeuses 24/6mm</produit>
    </commande>
    <commande id="CMD0008">
        <produit quantité="10" prix-unitaire="8.00">Agrafes pour agrafeuses 24/6mm</produit>
    </commande>
</commandes>


Et finalement, essayez d'afficher le prix total de chaque commande et de chaque produit commandé (créez votre liste de 
commandes dans une variable pour plus de facilité):

<commandes>
    <commande id="CMD0001" total="11.35">
        <produit quantité="1" prix-unitaire="5.50" total="5.5">Perforatrice de bureau - Buromat 6544</produit>
        <produit quantité="1" prix-unitaire="5.85" total="5.85">Agrafeuse manuelle - modèle Rapid Z1</produit>
    </commande>
    <commande id="CMD0002" total="246.95">
        <produit quantité="1" prix-unitaire="196.95" total="196.95">Agrafeuse électrique - modèle Rapid Z20</produit>
        <produit quantité="10" prix-unitaire="5.00" total="50">Agrafes pour agrafeuses 24/8mm</produit>
    </commande>
    <commande id="CMD0003" total="349">
        <produit quantité="1" prix-unitaire="163.00" total="163">Relieuse spirale (21 anneaux) - Rapid 200</produit>
        <produit quantité="10" prix-unitaire="9.20" total="92">Baguette pour reliure perforée 21 anneaux - 9mm</produit>
        <produit quantité="10" prix-unitaire="9.40" total="94">Baguette pour reliure perforée 21 anneaux - 11mm</produit>
    </commande>
    <commande id="CMD0004" total="11.35">
        <produit quantité="1" prix-unitaire="5.85" total="5.85">Agrafeuse manuelle - modèle Rapid Z1</produit>
        <produit quantité="1" prix-unitaire="5.50" total="5.5">Agrafes pour agrafeuses 24/8mm</produit>
    </commande>
    <commande id="CMD0005" total="493.9">
        <produit quantité="2" prix-unitaire="196.95" total="393.9">Agrafeuse électrique - modèle Rapid Z20</produit>
        <produit quantité="20" prix-unitaire="5.00" total="100">Agrafes pour agrafeuses 24/8mm</produit>
    </commande>
    <commande id="CMD0006" total="16">
        <produit quantité="2" prix-unitaire="8.00" total="16">Agrafes pour agrafeuses 24/6mm</produit>
    </commande>
    <commande id="CMD0007" total="16">
        <produit quantité="2" prix-unitaire="8.00" total="16">Agrafes pour agrafeuses 24/6mm</produit>
    </commande>
    <commande id="CMD0008" total="80">
        <produit quantité="10" prix-unitaire="8.00" total="80">Agrafes pour agrafeuses 24/6mm</produit>
    </commande>
</commandes>

